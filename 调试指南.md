# å›¾ç‰‡ä¸æ˜¾ç¤ºé—®é¢˜è°ƒè¯•æŒ‡å—

## ğŸ” è°ƒè¯•æ­¥éª¤

### æ­¥éª¤1: æ¸…é™¤ç¼“å­˜å¹¶é‡æ–°ç¼–è¯‘

1. åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­,ç‚¹å‡»èœå• **å·¥å…· â†’ æ¸…é™¤ç¼“å­˜ â†’ å…¨éƒ¨æ¸…é™¤**
2. ç‚¹å‡» **ç¼–è¯‘** æŒ‰é’®é‡æ–°ç¼–è¯‘é¡¹ç›®
3. ç¡®ä¿æ²¡æœ‰ç¼–è¯‘é”™è¯¯

---

### æ­¥éª¤2: æ‰“å¼€æ§åˆ¶å°

1. åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­,ç¡®ä¿ **Console** é¢æ¿æ˜¯æ‰“å¼€çš„
2. æ¸…ç©ºæ§åˆ¶å°æ—¥å¿—(ç‚¹å‡»åƒåœ¾æ¡¶å›¾æ ‡)

---

### æ­¥éª¤3: æ‰§è¡Œæµ‹è¯•æ“ä½œ

1. ç‚¹å‡»"å¸ƒå±€æ‹¼å›¾"
2. é€‰æ‹©ä¸€ä¸ªå¸ƒå±€(ä¾‹å¦‚"æ¨ªå‘ä¸‰åˆ— 3å¼ ")
3. ç‚¹å‡»Canvasä¸Šçš„ç¬¬1ä¸ªå ä½æ¡†
4. é€‰æ‹©ä¸€å¼ å›¾ç‰‡

---

### æ­¥éª¤4: æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—

**åº”è¯¥çœ‹åˆ°ä»¥ä¸‹æ—¥å¿—**:

```
ç‚¹å‡»äº†æ§½ä½: 0
æ›´æ–°æ§½ä½æ•°æ®: 0 http://tmp/...
updatedSlots[slotIndex]: {image: {...}, isEmpty: false}
æ‰€æœ‰æ§½ä½çŠ¶æ€: ["æ§½ä½0: isEmpty=false", "æ§½ä½1: isEmpty=true", "æ§½ä½2: isEmpty=true"]
setDataå®Œæˆ,å¼€å§‹é‡ç»˜Canvas
å½“å‰imageSlots: [{image: {...}, isEmpty: false}, {isEmpty: true}, {isEmpty: true}]
updateCanvasè¢«è°ƒç”¨
ctxå­˜åœ¨: true
currentLayoutTemplateå­˜åœ¨: true
imageSlots: [{image: {...}, isEmpty: false}, {isEmpty: true}, {isEmpty: true}]
hasImages: true
ç»˜åˆ¶å›¾ç‰‡, å¸ƒå±€: æ¨ªå‘ä¸‰åˆ—
ç»˜åˆ¶æ§½ä½0çš„å›¾ç‰‡: http://tmp/...
å¼€å§‹åŠ è½½å›¾ç‰‡: http://tmp/...
å›¾ç‰‡åŠ è½½æˆåŠŸ,å¼€å§‹ç»˜åˆ¶: http://tmp/...
å›¾ç‰‡ç»˜åˆ¶å®Œæˆ
æ‰€æœ‰å›¾ç‰‡ç»˜åˆ¶å®Œæˆ
Canvasé‡ç»˜å®Œæˆ
```

---

## ğŸ› å¸¸è§é—®é¢˜è¯Šæ–­

### é—®é¢˜1: hasImagesä¸ºfalse

**æ—¥å¿—æ˜¾ç¤º**:
```
hasImages: false
æ²¡æœ‰å›¾ç‰‡,ç»˜åˆ¶å ä½æ¡†
```

**åŸå› **: imageSlotsæ²¡æœ‰æ­£ç¡®æ›´æ–°,æˆ–è€…isEmptyæ²¡æœ‰è®¾ç½®ä¸ºfalse

**æ£€æŸ¥**:
- æŸ¥çœ‹"æ‰€æœ‰æ§½ä½çŠ¶æ€"æ—¥å¿—,ç¡®è®¤isEmptyæ˜¯å¦ä¸ºfalse
- æŸ¥çœ‹"å½“å‰imageSlots"æ—¥å¿—,ç¡®è®¤æ•°æ®æ˜¯å¦æ­£ç¡®

**è§£å†³æ–¹æ¡ˆ**:
- ç¡®ä¿setDataæ­£ç¡®æ‰§è¡Œ
- ç¡®ä¿updatedSlots[slotIndex].isEmpty = false

---

### é—®é¢˜2: ctxæˆ–currentLayoutTemplateä¸å­˜åœ¨

**æ—¥å¿—æ˜¾ç¤º**:
```
ctxå­˜åœ¨: false
æˆ–
currentLayoutTemplateå­˜åœ¨: false
Canvasæˆ–å¸ƒå±€æœªåˆå§‹åŒ–
```

**åŸå› **: Canvasæˆ–å¸ƒå±€æ¨¡æ¿æ²¡æœ‰æ­£ç¡®åˆå§‹åŒ–

**æ£€æŸ¥**:
- åœ¨æ§åˆ¶å°è¾“å…¥: `getCurrentPages()[getCurrentPages().length-1].data.ctx`
- åœ¨æ§åˆ¶å°è¾“å…¥: `getCurrentPages()[getCurrentPages().length-1].data.currentLayoutTemplate`

**è§£å†³æ–¹æ¡ˆ**:
- ç¡®ä¿é€‰æ‹©äº†å¸ƒå±€
- ç¡®ä¿Canvaså·²ç»åˆå§‹åŒ–(onReadyæ‰§è¡Œå®Œæˆ)

---

### é—®é¢˜3: å›¾ç‰‡åŠ è½½å¤±è´¥

**æ—¥å¿—æ˜¾ç¤º**:
```
å¼€å§‹åŠ è½½å›¾ç‰‡: http://tmp/...
å›¾ç‰‡åŠ è½½å¤±è´¥: http://tmp/... [é”™è¯¯ä¿¡æ¯]
```

**åŸå› **: å›¾ç‰‡è·¯å¾„é”™è¯¯æˆ–å›¾ç‰‡æ–‡ä»¶æŸå

**æ£€æŸ¥**:
- å›¾ç‰‡è·¯å¾„æ˜¯å¦æ­£ç¡®
- å›¾ç‰‡æ–‡ä»¶æ˜¯å¦å­˜åœ¨

**è§£å†³æ–¹æ¡ˆ**:
- é‡æ–°é€‰æ‹©å›¾ç‰‡
- æ£€æŸ¥wx.chooseMediaè¿”å›çš„è·¯å¾„

---

### é—®é¢˜4: Canvaså¯¹è±¡ä¸å­˜åœ¨

**æ—¥å¿—æ˜¾ç¤º**:
```
Canvaså¯¹è±¡ä¸å­˜åœ¨,æ— æ³•åŠ è½½å›¾ç‰‡
```

**åŸå› **: Canvaså¯¹è±¡åœ¨loadAndDrawImageæ—¶ä¸å­˜åœ¨

**æ£€æŸ¥**:
- åœ¨æ§åˆ¶å°è¾“å…¥: `getCurrentPages()[getCurrentPages().length-1].data.canvas`

**è§£å†³æ–¹æ¡ˆ**:
- ç¡®ä¿Canvaså·²ç»åˆå§‹åŒ–
- æ£€æŸ¥onReadyæ–¹æ³•æ˜¯å¦æ­£ç¡®æ‰§è¡Œ

---

### é—®é¢˜5: setDataæ²¡æœ‰æ‰§è¡Œå›è°ƒ

**æ—¥å¿—æ˜¾ç¤º**:
- æœ‰"æ›´æ–°æ§½ä½æ•°æ®"
- æ²¡æœ‰"setDataå®Œæˆ,å¼€å§‹é‡ç»˜Canvas"

**åŸå› **: setDataå›è°ƒæ²¡æœ‰æ‰§è¡Œ

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥ä»£ç æ˜¯å¦æ­£ç¡®
- å°è¯•é‡æ–°ç¼–è¯‘é¡¹ç›®

---

## ğŸ“Š å®Œæ•´çš„æ—¥å¿—æµç¨‹

### æ­£å¸¸æµç¨‹åº”è¯¥æ˜¯:

```
1. ç”¨æˆ·ç‚¹å‡»æ§½ä½
   â†“
   ç‚¹å‡»äº†æ§½ä½: 0

2. ç”¨æˆ·é€‰æ‹©å›¾ç‰‡
   â†“
   æ›´æ–°æ§½ä½æ•°æ®: 0 http://tmp/...
   updatedSlots[slotIndex]: {image: {...}, isEmpty: false}
   æ‰€æœ‰æ§½ä½çŠ¶æ€: ["æ§½ä½0: isEmpty=false", ...]

3. setDataæ‰§è¡Œ
   â†“
   setDataå®Œæˆ,å¼€å§‹é‡ç»˜Canvas
   å½“å‰imageSlots: [{image: {...}, isEmpty: false}, ...]

4. updateCanvasè¢«è°ƒç”¨
   â†“
   updateCanvasè¢«è°ƒç”¨
   ctxå­˜åœ¨: true
   currentLayoutTemplateå­˜åœ¨: true
   imageSlots: [{image: {...}, isEmpty: false}, ...]
   hasImages: true

5. å¼€å§‹ç»˜åˆ¶
   â†“
   ç»˜åˆ¶å›¾ç‰‡, å¸ƒå±€: æ¨ªå‘ä¸‰åˆ—
   ç»˜åˆ¶æ§½ä½0çš„å›¾ç‰‡: http://tmp/...

6. åŠ è½½å›¾ç‰‡
   â†“
   å¼€å§‹åŠ è½½å›¾ç‰‡: http://tmp/...
   å›¾ç‰‡åŠ è½½æˆåŠŸ,å¼€å§‹ç»˜åˆ¶: http://tmp/...
   å›¾ç‰‡ç»˜åˆ¶å®Œæˆ

7. å®Œæˆ
   â†“
   æ‰€æœ‰å›¾ç‰‡ç»˜åˆ¶å®Œæˆ
   Canvasé‡ç»˜å®Œæˆ
```

---

## ğŸ”§ æ‰‹åŠ¨æ£€æŸ¥æ•°æ®

### åœ¨æ§åˆ¶å°æ‰§è¡Œä»¥ä¸‹å‘½ä»¤:

```javascript
// è·å–å½“å‰é¡µé¢å®ä¾‹
const page = getCurrentPages()[getCurrentPages().length-1];

// æ£€æŸ¥Canvaså¯¹è±¡
console.log('canvas:', page.data.canvas);
console.log('ctx:', page.data.ctx);

// æ£€æŸ¥å¸ƒå±€æ¨¡æ¿
console.log('currentLayoutTemplate:', page.data.currentLayoutTemplate);

// æ£€æŸ¥å›¾ç‰‡æ§½ä½
console.log('imageSlots:', page.data.imageSlots);

// æ£€æŸ¥é€‰ä¸­çš„å›¾ç‰‡
console.log('selectedImages:', page.data.selectedImages);

// æ£€æŸ¥å›¾ç‰‡ä½ç½®
console.log('imagePositions:', page.data.imagePositions);
```

---

## ğŸ“ è¯·æä¾›ä»¥ä¸‹ä¿¡æ¯

å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨,è¯·æä¾›:

1. **å®Œæ•´çš„æ§åˆ¶å°æ—¥å¿—** (ä»ç‚¹å‡»æ§½ä½åˆ°é€‰æ‹©å›¾ç‰‡å®Œæˆ)
2. **æ‰‹åŠ¨æ£€æŸ¥æ•°æ®çš„ç»“æœ** (æ‰§è¡Œä¸Šé¢çš„å‘½ä»¤)
3. **å…·ä½“çš„æ“ä½œæ­¥éª¤**
4. **æ˜¯å¦æœ‰ä»»ä½•é”™è¯¯æç¤º**

---

## ğŸ¯ å¿«é€Ÿè¯Šæ–­

### æ£€æŸ¥ç‚¹1: imageSlotsæ˜¯å¦æ­£ç¡®æ›´æ–°?

åœ¨é€‰æ‹©å›¾ç‰‡å,åœ¨æ§åˆ¶å°è¾“å…¥:
```javascript
getCurrentPages()[getCurrentPages().length-1].data.imageSlots
```

**é¢„æœŸç»“æœ**:
```javascript
[
  {image: {path: "http://tmp/..."}, isEmpty: false},  // ç¬¬1ä¸ªæ§½ä½æœ‰å›¾ç‰‡
  {isEmpty: true},  // ç¬¬2ä¸ªæ§½ä½ç©º
  {isEmpty: true}   // ç¬¬3ä¸ªæ§½ä½ç©º
]
```

**å¦‚æœisEmptyä»ç„¶æ˜¯true,è¯´æ˜setDataæ²¡æœ‰ç”Ÿæ•ˆ!**

---

### æ£€æŸ¥ç‚¹2: updateCanvasæ˜¯å¦è¢«è°ƒç”¨?

æŸ¥çœ‹æ§åˆ¶å°æ˜¯å¦æœ‰:
```
updateCanvasè¢«è°ƒç”¨
```

**å¦‚æœæ²¡æœ‰,è¯´æ˜setDataå›è°ƒæ²¡æœ‰æ‰§è¡Œ!**

---

### æ£€æŸ¥ç‚¹3: hasImagesæ˜¯å¦ä¸ºtrue?

æŸ¥çœ‹æ§åˆ¶å°æ˜¯å¦æœ‰:
```
hasImages: true
```

**å¦‚æœæ˜¯false,è¯´æ˜imageSlots.some(slot => !slot.isEmpty)è¿”å›äº†false!**

---

### æ£€æŸ¥ç‚¹4: å›¾ç‰‡æ˜¯å¦å¼€å§‹åŠ è½½?

æŸ¥çœ‹æ§åˆ¶å°æ˜¯å¦æœ‰:
```
å¼€å§‹åŠ è½½å›¾ç‰‡: http://tmp/...
```

**å¦‚æœæ²¡æœ‰,è¯´æ˜æ²¡æœ‰è¿›å…¥å›¾ç‰‡ç»˜åˆ¶é€»è¾‘!**

---

## ğŸ’¡ ä¸´æ—¶è§£å†³æ–¹æ¡ˆ

å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨,å¯ä»¥å°è¯•:

### æ–¹æ¡ˆ1: å¢åŠ å»¶è¿Ÿæ—¶é—´

ä¿®æ”¹`selectImageForSlot`æ–¹æ³•ä¸­çš„å»¶è¿Ÿ:
```javascript
setTimeout(() => {
  that.updateCanvas();
}, 500);  // ä»100msæ”¹ä¸º500ms
```

### æ–¹æ¡ˆ2: å¼ºåˆ¶åˆ·æ–°

åœ¨setDataå›è°ƒä¸­æ·»åŠ :
```javascript
that.setData({
  imageSlots: updatedSlots,
  selectedImages: updatedImages,
  workflowStep: 'editing'
}, () => {
  console.log('setDataå®Œæˆ');
  
  // å¼ºåˆ¶è§¦å‘æ•°æ®æ›´æ–°
  that.setData({
    _refresh: Date.now()
  }, () => {
    setTimeout(() => {
      that.updateCanvas();
    }, 100);
  });
});
```

### æ–¹æ¡ˆ3: ç›´æ¥è°ƒç”¨ç»˜åˆ¶

è·³è¿‡hasImagesæ£€æŸ¥,ç›´æ¥ç»˜åˆ¶:
```javascript
// åœ¨updateCanvasæ–¹æ³•ä¸­ä¸´æ—¶æ³¨é‡Šæ‰hasImagesæ£€æŸ¥
// if (!hasImages) {
//   console.log('æ²¡æœ‰å›¾ç‰‡,ç»˜åˆ¶å ä½æ¡†');
//   this.drawPlaceholders();
//   return;
// }
```

---

ç°åœ¨è¯·æŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤è¿›è¡Œè°ƒè¯•,å¹¶æŠŠæ§åˆ¶å°æ—¥å¿—å‘ç»™æˆ‘!

