# 布局拼图功能测试指南

## 📋 测试前准备

1. **打开微信开发者工具**
2. **编译项目** (Ctrl+B 或点击编译按钮)
3. **清除缓存** (工具 → 清除缓存 → 全部清除)
4. **重新编译**

---

## 🧪 测试场景

### 场景1: 基础流程 - 选择布局并添加图片

**步骤**:
1. 点击首页的"布局拼图"
2. 看到布局选择界面,显示分类标签
3. 点击"3张"标签
4. 选择"横向三列"布局
5. Canvas显示3个占位框,每个框中间有+号
6. 点击Canvas上第1个占位框(+号)
7. 选择一张图片
8. 图片显示在第1个位置
9. 点击Canvas上第2个占位框
10. 选择一张图片
11. 图片显示在第2个位置
12. 点击"一键上传"按钮
13. 选择1张图片(因为只剩1个空位)
14. 图片自动填充到第3个位置

**预期结果**:
- ✅ 布局分类标签正常显示
- ✅ 点击分类后只显示对应数量的布局
- ✅ Canvas占位框正确显示
- ✅ 点击Canvas占位框能打开图片选择器
- ✅ 图片正确显示在Canvas上
- ✅ 一键上传受到剩余容量限制

---

### 场景2: 布局分类切换

**步骤**:
1. 进入布局选择界面
2. 默认显示"全部"布局
3. 点击"2张"标签
4. 观察布局列表变化
5. 点击"4张"标签
6. 观察布局列表变化
7. 点击"全部"标签
8. 观察布局列表变化

**预期结果**:
- ✅ 默认显示所有布局
- ✅ 点击"2张"只显示2张图片的布局
- ✅ 点击"4张"只显示4张图片的布局
- ✅ 点击"全部"显示所有布局
- ✅ 选中的标签有高亮效果

---

### 场景3: Canvas点击交互

**步骤**:
1. 选择"上1下2"布局(3张)
2. Canvas显示3个占位框
3. 点击Canvas上方的占位框
4. 选择图片A
5. 点击Canvas左下方的占位框
6. 选择图片B
7. 点击Canvas右下方的占位框
8. 选择图片C

**预期结果**:
- ✅ 每次点击都能准确识别点击的是哪个占位框
- ✅ 图片填充到正确的位置
- ✅ 不同位置的占位框都能正常点击

---

### 场景4: 替换和删除图片

**步骤**:
1. 选择布局并添加3张图片
2. 点击Canvas上已有图片的位置
3. 弹出确认对话框"是否替换这张图片?"
4. 点击"确定"
5. 选择新图片
6. 图片被替换
7. 点击下方槽位列表中的×号
8. 图片被移除,恢复为占位框

**预期结果**:
- ✅ 点击已有图片弹出替换确认
- ✅ 替换功能正常工作
- ✅ 删除功能正常工作
- ✅ 删除后Canvas恢复占位框显示

---

### 场景5: 更换布局

**步骤**:
1. 选择"横向排列(2张)"布局
2. 添加2张图片
3. 点击"更换布局"按钮
4. 弹出确认对话框
5. 点击"确定"
6. 返回布局选择界面
7. 选择"竖向排列(2张)"布局
8. Canvas显示新布局的占位框

**预期结果**:
- ✅ 更换布局前有确认提示
- ✅ 确认后清空已添加的图片
- ✅ 返回布局选择界面
- ✅ 选择新布局后正常工作

---

### 场景6: 导出功能 ⭐ 重点测试

**步骤**:
1. 选择"左1右2"布局(3张)
2. 添加3张图片
3. 调整间距为15
4. 调整圆角为10
5. 点击"保存"按钮
6. 等待导出完成

**预期结果**:
- ✅ 不报错"Canvas对象不存在"
- ✅ 不报错"images is not defined"
- ✅ 不报错"未找到布局配置"
- ✅ 成功导出图片
- ✅ 导出的图片包含所有3张图片
- ✅ 导出的图片布局正确
- ✅ 间距和圆角正确应用

**控制台日志应该显示**:
```
导出: 使用布局 左1右2
图片绘制完成
Canvas导出成功
```

---

### 场景7: 一键上传限制

**步骤**:
1. 选择"2×2网格"布局(4张)
2. 点击"一键上传"
3. 选择2张图片
4. 图片填充到前2个位置
5. 再次点击"一键上传"
6. 选择3张图片(但只能选2张)
7. 图片填充到剩余2个位置
8. 再次点击"一键上传"
9. 提示"当前布局最多4张图片"

**预期结果**:
- ✅ 第一次上传成功添加2张
- ✅ 第二次只能选择剩余数量的图片
- ✅ 图片填满后提示容量已满
- ✅ 图片按顺序填充到空槽位

---

### 场景8: 样式调整

**步骤**:
1. 选择布局并添加图片
2. 调整间距滑块
3. 观察Canvas实时更新
4. 调整圆角滑块
5. 观察Canvas实时更新
6. 修改背景颜色
7. 观察Canvas实时更新

**预期结果**:
- ✅ 间距调整实时生效
- ✅ 圆角调整实时生效
- ✅ 背景颜色调整实时生效
- ✅ 图片位置和大小正确计算

---

### 场景9: 边界情况测试

#### 9.1 未选择布局就上传
**步骤**:
1. 进入布局拼图页面
2. 不选择布局,直接点击"一键上传"

**预期结果**:
- ✅ 提示"请先选择布局模板"

#### 9.2 选择大容量布局
**步骤**:
1. 选择"4×4网格"布局(16张)
2. 点击"一键上传"
3. 选择9张图片(微信限制最多9张)
4. 再次点击"一键上传"
5. 选择7张图片

**预期结果**:
- ✅ 第一次成功添加9张
- ✅ 第二次成功添加7张
- ✅ 总共16张图片全部显示

#### 9.3 空槽位导出
**步骤**:
1. 选择"3张"布局
2. 只添加1张图片
3. 点击"保存"

**预期结果**:
- ✅ 成功导出
- ✅ 导出的图片只包含已添加的1张图片
- ✅ 空槽位不显示在导出图片中

---

## 🐛 已知问题检查清单

### 导出相关
- [ ] 导出时不报错"Canvas对象不存在"
- [ ] 导出时不报错"images is not defined"
- [ ] 导出时不报错"未找到布局配置"
- [ ] 导出的图片包含所有已添加的图片
- [ ] 导出的图片布局正确

### 图片显示相关
- [ ] 添加图片后立即显示在Canvas上
- [ ] 图片保持宽高比
- [ ] 图片居中显示在槽位中
- [ ] 间距和圆角正确应用

### 交互相关
- [ ] 点击Canvas占位框能打开图片选择器
- [ ] 点击已有图片能替换
- [ ] 点击×号能删除图片
- [ ] 布局分类切换正常

---

## 📊 测试报告模板

### 测试环境
- 微信开发者工具版本: ___________
- 基础库版本: 2.19.4
- 操作系统: Windows/Mac
- 测试日期: ___________

### 测试结果

| 场景 | 状态 | 备注 |
|------|------|------|
| 场景1: 基础流程 | ✅/❌ | |
| 场景2: 布局分类切换 | ✅/❌ | |
| 场景3: Canvas点击交互 | ✅/❌ | |
| 场景4: 替换和删除图片 | ✅/❌ | |
| 场景5: 更换布局 | ✅/❌ | |
| 场景6: 导出功能 | ✅/❌ | |
| 场景7: 一键上传限制 | ✅/❌ | |
| 场景8: 样式调整 | ✅/❌ | |
| 场景9: 边界情况 | ✅/❌ | |

### 发现的问题
1. ___________
2. ___________
3. ___________

### 建议
1. ___________
2. ___________
3. ___________

---

## 🔍 调试技巧

### 查看控制台日志
关键日志输出:
```
加载了 60 个布局模板, 16 个分组
选择布局模板: 5
选中的布局: 横向三列 图片数量: 3
绘制占位框, 布局: 横向三列
点击了槽位: 0
绘制槽位0的图片: http://...
所有图片绘制完成
导出: 使用布局 横向三列
```

### 常见问题排查

**问题**: 图片不显示
- 检查控制台是否有"绘制槽位X的图片"日志
- 检查图片路径是否正确
- 检查imageSlots数据结构

**问题**: 导出失败
- 检查currentLayoutTemplate是否存在
- 检查imageSlots是否有数据
- 检查控制台错误信息

**问题**: 点击Canvas没反应
- 检查imagePositions是否正确计算
- 检查getHitSlotIndex方法是否正确
- 检查点击坐标是否在范围内

---

## ✅ 测试完成标准

所有以下项目都通过才算测试完成:

- [ ] 所有9个测试场景都通过
- [ ] 导出功能完全正常,无报错
- [ ] 图片显示正常,无延迟
- [ ] Canvas点击交互流畅
- [ ] 布局分类切换正常
- [ ] 边界情况处理正确
- [ ] 无控制台错误
- [ ] 用户体验流畅

---

**祝测试顺利!** 🎉

