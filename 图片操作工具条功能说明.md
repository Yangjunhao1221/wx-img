# 图片操作工具条功能说明

## 📋 功能概述

在布局拼图页面，点击画布上已有图片时，会弹出一个操作工具条，提供以下5个功能：

1. **换一张** 🔄 - 替换当前图片
2. **旋转** ↻ - 旋转图片90度
3. **放大** 🔍+ - 放大图片（最大200%）
4. **缩小** 🔍- - 缩小图片（最小50%）
5. **删除** 🗑️ - 删除当前图片

## 🎨 UI设计

### 工具条样式
- **背景**: 半透明深色背景（rgba(50, 50, 50, 0.95)）
- **毛玻璃效果**: backdrop-filter: blur(10px)
- **圆角**: 12px
- **阴影**: 0 4px 20px rgba(0, 0, 0, 0.3)
- **动画**: 淡入动画，从上方滑入

### 工具条位置
- 默认显示在图片下方中央
- 如果下方空间不足，自动显示在图片上方
- 自动进行边界检查，确保不超出画布范围

### 按钮设计
- 每个按钮包含图标和文字标签
- 按下时有缩放反馈效果
- 白色文字，带阴影效果

## 🔧 功能详解

### 1. 换一张
- 点击后打开相册/相机选择新图片
- 替换当前槽位的图片
- 保持原有的缩放和旋转设置会被重置
- 自动重新绘制画布

### 2. 旋转
- 每次点击旋转90度
- 支持0°、90°、180°、270°四个角度
- 旋转角度会在导出时保留
- 显示当前旋转角度提示

### 3. 放大
- 每次点击放大10%
- 最大缩放比例：200%
- 显示当前缩放百分比
- 缩放以图片中心为基准点

### 4. 缩小
- 每次点击缩小10%
- 最小缩放比例：50%
- 显示当前缩放百分比
- 缩放以图片中心为基准点

### 5. 删除
- 点击后弹出确认对话框
- 确认后清空该槽位
- 清除该图片的所有设置（缩放、旋转）
- 槽位变为空槽位，可重新添加图片

## 💻 技术实现

### 数据结构
```javascript
data: {
  showImageToolbar: false,      // 是否显示工具条
  toolbarImageIndex: -1,        // 工具条对应的图片索引
  toolbarPosition: { x: 0, y: 0 }, // 工具条位置
  imageScale: {},               // 每张图片的缩放比例 {index: scale}
  imageRotation: {},            // 每张图片的旋转角度 {index: angle}
}
```

### 核心方法

#### showImageToolbar(imageIndex, touchX, touchY)
显示工具条，计算合适的位置

#### hideImageToolbar()
隐藏工具条

#### onToolbarReplace()
换一张图片

#### onToolbarRotate()
旋转图片90度

#### onToolbarZoomIn()
放大图片

#### onToolbarZoomOut()
缩小图片

#### onToolbarDelete()
删除图片

### Canvas绘制支持
修改了 `loadAndDrawImage` 方法，支持：
- 应用缩放变换（scale）
- 应用旋转变换（rotate）
- 以图片中心为变换基准点

### 导出支持
修改了导出图片的绘制逻辑，确保：
- 导出的图片包含缩放效果
- 导出的图片包含旋转效果
- 变换效果与预览一致

## 📱 使用流程

1. **进入布局拼图页面**
2. **选择布局模板**
3. **添加图片到槽位**
4. **点击画布上的图片**
   - 工具条自动弹出
5. **使用工具条功能**
   - 换一张：选择新图片替换
   - 旋转：调整图片角度
   - 放大/缩小：调整图片大小
   - 删除：移除图片
6. **点击工具条外部区域关闭工具条**
7. **继续编辑或导出图片**

## ⚠️ 注意事项

1. **点击空槽位**：不会显示工具条，而是触发添加图片功能
2. **点击已有图片**：显示工具条，不会触发拖拽功能
3. **工具条显示时**：点击画布其他区域会关闭工具条
4. **缩放和旋转**：会在导出时保留，确保预览和导出一致
5. **删除图片**：需要确认，防止误操作

## 🎯 优化建议

### 已实现
- ✅ 工具条位置自动调整
- ✅ 边界检查
- ✅ 淡入动画
- ✅ 点击反馈
- ✅ 缩放和旋转支持
- ✅ 导出时保留变换效果

### 未来可扩展
- 🔲 支持自由拖拽调整位置
- 🔲 支持双指缩放手势
- 🔲 支持旋转手势
- 🔲 支持图片裁剪
- 🔲 支持图片滤镜
- 🔲 撤销/重做功能

## 🐛 已知问题

目前没有已知问题。如果发现问题，请及时反馈。

## 📝 更新日志

### v1.0.0 (2025-11-05)
- ✨ 新增图片操作工具条
- ✨ 支持换一张功能
- ✨ 支持旋转功能（90度递增）
- ✨ 支持放大/缩小功能（10%递增/递减）
- ✨ 支持删除功能
- ✨ 工具条自动定位和边界检查
- ✨ Canvas绘制支持缩放和旋转
- ✨ 导出图片支持缩放和旋转

---

**开发者**: Augment Agent  
**日期**: 2025-11-05

