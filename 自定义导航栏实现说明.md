# è‡ªå®šä¹‰å¯¼èˆªæ å®ç°è¯´æ˜

## ğŸ“‹ éœ€æ±‚

å°†ä¿å­˜æŒ‰é’®æ”¾åœ¨é¡µé¢æ ‡é¢˜çš„å·¦è¾¹,éœ€è¦è‡ªå®šä¹‰å¯¼èˆªæ ã€‚

## âœ… å®ç°æ–¹æ¡ˆ

### 1. é¡µé¢é…ç½® (collage.json)

```json
{
  "navigationStyle": "custom",
  "usingComponents": {}
}
```

**è¯´æ˜**:
- `navigationStyle: "custom"` - å¯ç”¨è‡ªå®šä¹‰å¯¼èˆªæ ,åªä¿ç•™å³ä¸Šè§’èƒ¶å›ŠæŒ‰é’®
- é€‚ç”¨äº iOS/Android å¾®ä¿¡å®¢æˆ·ç«¯ 7.0.0+

### 2. å¯¼èˆªæ å¸ƒå±€ç»“æ„ (collage.wxml)

```xml
<!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
<view class="custom-navigation-bar" style="padding-top: {{statusBarHeight}}px;">
  <!-- å¯¼èˆªæ å†…å®¹ -->
  <view class="navigation-bar-content" style="height: {{navigationBarHeight}}px;">
    <!-- å·¦ä¾§æŒ‰é’®ç»„ -->
    <view class="nav-left">
      <!-- è¿”å›æŒ‰é’® -->
      <view class="nav-back" bindtap="onNavBack">
        <text class="nav-back-icon">â€¹</text>
      </view>

      <!-- ä¿å­˜æŒ‰é’® -->
      <view class="nav-save" wx:if="{{selectedImages.length > 0}}" bindtap="exportImage">
        <text class="nav-save-text">ä¿å­˜</text>
      </view>
    </view>

    <!-- é¡µé¢æ ‡é¢˜ -->
    <view class="nav-title">
      <text class="nav-title-text">æ‹¼å›¾ç¼–è¾‘</text>
    </view>

    <!-- å³ä¾§å ä½,ä¿æŒå¸ƒå±€å¹³è¡¡ -->
    <view class="nav-right"></view>
  </view>
</view>
```

**å¸ƒå±€è¯´æ˜**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [çŠ¶æ€æ å ä½]                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [â€¹][ä¿å­˜]      æ‹¼å›¾ç¼–è¾‘          [èƒ¶å›Š]  â”‚ â† å¯¼èˆªæ 
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†‘å·¦ä¾§ç»„        â†‘æ ‡é¢˜å±…ä¸­         â†‘å³ä¾§å ä½
```

### 3. å¯¼èˆªæ æ ·å¼ (collage.wxss)

#### 3.1 å¯¼èˆªæ å®¹å™¨

```css
.custom-navigation-bar {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  background: #ffffff;
  z-index: 10000;
  box-shadow: 0 1px 0 rgba(0, 0, 0, 0.05);
}
```

#### 3.2 å¯¼èˆªæ å†…å®¹

```css
.navigation-bar-content {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 16px;
  position: relative;
}
```

#### 3.3 è¿”å›æŒ‰é’®

```css
.nav-back {
  width: 44px;
  height: 44px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.nav-back-icon {
  font-size: 32px;
  color: #0071e3;
  font-weight: 300;
  line-height: 1;
}
```

#### 3.4 å·¦ä¾§æŒ‰é’®ç»„

```css
.nav-left {
  display: flex;
  align-items: center;
  flex: 1;
  min-width: 0;
}
```

#### 3.5 ä¿å­˜æŒ‰é’®

```css
.nav-save {
  padding: 6px 16px;
  height: 32px;
  background: #0071e3;
  border-radius: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  margin-left: 4px;
}

.nav-save-text {
  font-size: 15px;
  color: #ffffff;
  font-weight: 500;
  letter-spacing: -0.3px;
  line-height: 1;
}

.nav-save:active {
  opacity: 0.8;
  transform: scale(0.96);
}
```

**è¯´æ˜**: ä¿å­˜æŒ‰é’®ä½¿ç”¨è“è‰²èƒŒæ™¯,ç™½è‰²æ–‡å­—,åœ†è§’èƒ¶å›Šæ ·å¼

#### 3.6 é¡µé¢æ ‡é¢˜

```css
.nav-title {
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  align-items: center;
  justify-content: center;
  pointer-events: none;
  max-width: 40%;
}

.nav-title-text {
  font-size: 17px;
  color: #1d1d1f;
  font-weight: 600;
  letter-spacing: -0.3px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
```

**è¯´æ˜**:
- æ ‡é¢˜ä½¿ç”¨ç»å¯¹å®šä½å±…ä¸­,ä¸å—å·¦å³æŒ‰é’®å½±å“
- æœ€å¤§å®½åº¦ 40%,é¿å…ä¸å·¦å³æŒ‰é’®é‡å 
- æ–‡å­—è¶…é•¿æ—¶æ˜¾ç¤ºçœç•¥å·

#### 3.7 å³ä¾§å ä½

```css
.nav-right {
  flex: 1;
  min-width: 0;
}
```

**è¯´æ˜**: å³ä¾§å ä½å…ƒç´ ä¸å·¦ä¾§æŒ‰é’®ç»„å¯¹ç§°,ä¿æŒæ ‡é¢˜å±…ä¸­

### 4. å¯¼èˆªæ é€»è¾‘ (collage.js)

#### 4.1 æ•°æ®å­—æ®µ

```javascript
data: {
  statusBarHeight: 0,      // çŠ¶æ€æ é«˜åº¦
  navigationBarHeight: 44, // å¯¼èˆªæ é«˜åº¦(ä¸å«çŠ¶æ€æ )
  menuButtonInfo: null,    // èƒ¶å›ŠæŒ‰é’®ä¿¡æ¯
}
```

#### 4.2 åˆå§‹åŒ–æ–¹æ³•

```javascript
initCustomNavigationBar () {
  try {
    // è·å–ç³»ç»Ÿä¿¡æ¯
    const systemInfo = wx.getSystemInfoSync();
    const statusBarHeight = systemInfo.statusBarHeight || 0;
    
    // è·å–èƒ¶å›ŠæŒ‰é’®ä¿¡æ¯
    const menuButtonInfo = wx.getMenuButtonBoundingClientRect();
    
    // è®¡ç®—å¯¼èˆªæ é«˜åº¦ = èƒ¶å›ŠæŒ‰é’®é«˜åº¦ + (èƒ¶å›ŠæŒ‰é’®top - çŠ¶æ€æ é«˜åº¦) * 2
    const navigationBarHeight = menuButtonInfo.height + (menuButtonInfo.top - statusBarHeight) * 2;
    
    this.setData({
      statusBarHeight: statusBarHeight,
      navigationBarHeight: navigationBarHeight,
      menuButtonInfo: menuButtonInfo
    });
  } catch (error) {
    console.error('åˆå§‹åŒ–è‡ªå®šä¹‰å¯¼èˆªæ å¤±è´¥:', error);
  }
}
```

#### 4.3 è¿”å›æŒ‰é’®å¤„ç†

```javascript
onNavBack () {
  wx.navigateBack({
    delta: 1
  });
}
```

### 5. é¡µé¢å†…å®¹åŒºåŸŸé€‚é…

ä¸ºäº†é¿å…å†…å®¹è¢«å¯¼èˆªæ é®æŒ¡,éœ€è¦ä¸ºé¡µé¢å†…å®¹æ·»åŠ é¡¶éƒ¨ padding:

```css
.layout-selection-area,
.editing-area-new {
  padding-top: calc(var(--status-bar-height, 20px) + var(--navigation-bar-height, 44px));
  box-sizing: border-box;
}
```

## ğŸ¨ è®¾è®¡ç‰¹ç‚¹

1. **è‹¹æœé£æ ¼**: ç®€æ´çš„è®¾è®¡,è“è‰²æŒ‰é’®,ç»†çº¿åˆ†éš”
2. **å“åº”å¼**: è‡ªåŠ¨é€‚é…ä¸åŒè®¾å¤‡çš„çŠ¶æ€æ å’Œå¯¼èˆªæ é«˜åº¦
3. **çµæ´»å¸ƒå±€**: 
   - å·¦ä¾§: è¿”å›æŒ‰é’® + ä¿å­˜æŒ‰é’®
   - ä¸­é—´: æ ‡é¢˜(ç»å¯¹å®šä½å±…ä¸­)
   - å³ä¾§: å ä½å…ƒç´ (ä¿æŒå¸ƒå±€å¹³è¡¡)
4. **æ¡ä»¶æ˜¾ç¤º**: ä¿å­˜æŒ‰é’®ä»…åœ¨æœ‰å›¾ç‰‡æ—¶æ˜¾ç¤º
5. **äº¤äº’åé¦ˆ**: æŒ‰é’®ç‚¹å‡»æ—¶é€æ˜åº¦å˜åŒ–

## ğŸ“ å°ºå¯¸è®¡ç®—

### çŠ¶æ€æ é«˜åº¦
- é€šè¿‡ `wx.getSystemInfoSync().statusBarHeight` è·å–
- ä¸åŒè®¾å¤‡é«˜åº¦ä¸åŒ(iPhone X: 44px, æ™®é€šè®¾å¤‡: 20px)

### å¯¼èˆªæ é«˜åº¦
- å…¬å¼: `èƒ¶å›Šé«˜åº¦ + (èƒ¶å›Štop - çŠ¶æ€æ é«˜åº¦) Ã— 2`
- é€šè¿‡ `wx.getMenuButtonBoundingClientRect()` è·å–èƒ¶å›Šä¿¡æ¯
- ç¡®ä¿å¯¼èˆªæ ä¸èƒ¶å›Šå‚ç›´å±…ä¸­å¯¹é½

### æ€»é«˜åº¦
- `æ€»é«˜åº¦ = çŠ¶æ€æ é«˜åº¦ + å¯¼èˆªæ é«˜åº¦`
- é¡µé¢å†…å®¹éœ€è¦é¢„ç•™è¿™ä¸ªé«˜åº¦çš„é¡¶éƒ¨ç©ºé—´

## ğŸ”§ å…³é”® API

1. **wx.getSystemInfoSync()** - è·å–ç³»ç»Ÿä¿¡æ¯(çŠ¶æ€æ é«˜åº¦ç­‰)
2. **wx.getMenuButtonBoundingClientRect()** - è·å–èƒ¶å›ŠæŒ‰é’®ä½ç½®ä¿¡æ¯
3. **wx.navigateBack()** - è¿”å›ä¸Šä¸€é¡µ

## âœ¨ ä¼˜åŠ¿

1. âœ… **å®Œå…¨è‡ªå®šä¹‰**: å¯ä»¥è‡ªç”±è®¾è®¡å¯¼èˆªæ å¸ƒå±€
2. âœ… **ä¿ç•™èƒ¶å›Š**: ç³»ç»Ÿèƒ¶å›ŠæŒ‰é’®ä»ç„¶ä¿ç•™,ç”¨æˆ·ä½“éªŒä¸€è‡´
3. âœ… **çµæ´»æ§åˆ¶**: å¯ä»¥åŠ¨æ€æ˜¾ç¤º/éšè—æŒ‰é’®
4. âœ… **é€‚é…æ€§å¥½**: è‡ªåŠ¨é€‚é…ä¸åŒè®¾å¤‡å’Œç³»ç»Ÿç‰ˆæœ¬

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **å…¼å®¹æ€§**: `navigationStyle: "custom"` éœ€è¦å¾®ä¿¡å®¢æˆ·ç«¯ 7.0.0+
2. **å±‚çº§ç®¡ç†**: å¯¼èˆªæ  z-index è®¾ä¸º 10000,ç¡®ä¿åœ¨æœ€ä¸Šå±‚
3. **å®‰å…¨åŒºåŸŸ**: éœ€è¦è€ƒè™‘åˆ˜æµ·å±ç­‰ç‰¹æ®Šè®¾å¤‡çš„å®‰å…¨åŒºåŸŸ
4. **æ€§èƒ½ä¼˜åŒ–**: å¯¼èˆªæ å›ºå®šå®šä½,ä¸å½±å“é¡µé¢æ»šåŠ¨æ€§èƒ½

