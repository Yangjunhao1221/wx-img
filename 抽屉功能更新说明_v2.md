# æŠ½å±‰åŠŸèƒ½æ›´æ–°è¯´æ˜ v2.0

## ğŸ“… æ›´æ–°æ—¥æœŸ
2025-11-06

---

## ğŸ¯ æœ¬æ¬¡æ›´æ–°å†…å®¹

### 1. ç”»å¸ƒæœ€å°é«˜åº¦é™åˆ¶ âœ…

**éœ€æ±‚**ï¼š
æ‹–åŠ¨åˆ°ç¬¬äºŒå±‚æ—¶ï¼Œç”»å¸ƒçš„æœ€å°é«˜åº¦åº”è¯¥æ˜¯å±å¹•çš„50%

**å®ç°æ–¹æ¡ˆ**ï¼š
```javascript
// è®¡ç®—æœ€å¤§æŠ½å±‰é«˜åº¦ï¼Œç¡®ä¿ç”»å¸ƒè‡³å°‘å å±å¹•çš„50%
const topBarHeight = statusBarHeight + navigationBarHeight;
const minCanvasHeight = windowHeight * 0.5; // ç”»å¸ƒæœ€å°é«˜åº¦ä¸ºå±å¹•çš„50%
const maxDrawerHeight = windowHeight - topBarHeight - minCanvasHeight - 32; // 32æ˜¯è¾¹è·

// æŠ½å±‰æœ€å¤§é«˜åº¦ä¸º70%å±å¹•é«˜åº¦ï¼Œä½†ä¸èƒ½è¶…è¿‡maxDrawerHeight
drawerHeight = Math.min(windowHeight * 0.7, maxDrawerHeight);
```

**æ•ˆæœ**ï¼š
- æ”¶èµ·çŠ¶æ€ï¼šæŠ½å±‰é«˜åº¦ = 60pxï¼Œç”»å¸ƒæœ€å¤§
- åŠå±•å¼€çŠ¶æ€ï¼šæŠ½å±‰é«˜åº¦ = 300pxï¼Œç”»å¸ƒé€‚ä¸­
- å…¨å±•å¼€çŠ¶æ€ï¼šæŠ½å±‰é«˜åº¦ = è®¡ç®—å€¼ï¼Œ**ç”»å¸ƒè‡³å°‘å å±å¹•50%**

**ä¿®æ”¹çš„æ–‡ä»¶**ï¼š
- `pages/collage/collage.js` - `expandDrawer` æ–¹æ³•
- `pages/collage/collage.js` - `onDrawerTouchMove` æ–¹æ³•
- `pages/collage/collage.js` - `onDrawerTouchEnd` æ–¹æ³•

---

### 2. æ™ºèƒ½æ‹–åŠ¨åŠŸèƒ½ âœ…

**éœ€æ±‚**ï¼š
åœ¨æ“ä½œåŒºåŸŸå¾€ä¸Šæ»‘ï¼Œå¦‚æœæ²¡æœ‰æ»šåŠ¨æ¡æˆ–æ»šåŠ¨æ¡å·²ç»åˆ°åº•äº†ï¼Œå†æ¬¡æ»‘åŠ¨å°±ä¼šè§¦å‘æ»‘åŠ¨åˆ°ç¬¬äºŒå±‚

**å®ç°æ–¹æ¡ˆ**ï¼š

#### 2.1 ç›‘å¬å†…å®¹åŒºåŸŸæ»šåŠ¨çŠ¶æ€
```javascript
// æ–°å¢å±æ€§
_contentScrollTop: 0,      // å†…å®¹åŒºåŸŸæ»šåŠ¨ä½ç½®
_contentTouchStartY: 0,    // å†…å®¹åŒºåŸŸè§¦æ‘¸èµ·å§‹Yåæ ‡
_isContentAtTop: true,     // å†…å®¹åŒºåŸŸæ˜¯å¦åœ¨é¡¶éƒ¨
```

#### 2.2 æ™ºèƒ½åˆ¤æ–­é€»è¾‘
```javascript
onContentTouchMove (e) {
  const deltaY = this._contentTouchStartY - touch.clientY; // å‘ä¸Šä¸ºæ­£
  
  // å¦‚æœå†…å®¹åœ¨é¡¶éƒ¨ï¼Œä¸”å‘ä¸Šæ»‘åŠ¨ï¼Œåˆ™è§¦å‘æŠ½å±‰å±•å¼€
  if (this._isContentAtTop && deltaY > 10) {
    // æ¨¡æ‹ŸæŠ½å±‰æ‹–åŠ¨
    const newHeight = drawerHeight + deltaY * 0.5;
    // æ›´æ–°æŠ½å±‰é«˜åº¦...
  } else {
    // å†…å®¹ä¸åœ¨é¡¶éƒ¨ï¼Œæˆ–å‘ä¸‹æ»‘åŠ¨ï¼Œæ­£å¸¸æ»šåŠ¨
    if (deltaY < 0) {
      this._isContentAtTop = false;
    }
  }
}
```

#### 2.3 æ–°å¢æ–¹æ³•
- `onContentScrollToUpper()` - å†…å®¹æ»šåŠ¨åˆ°é¡¶éƒ¨æ—¶è§¦å‘ï¼Œæ ‡è®° `_isContentAtTop = true`
- `onContentTouchStart()` - è®°å½•è§¦æ‘¸èµ·å§‹ä½ç½®
- `onContentTouchMove()` - æ™ºèƒ½åˆ¤æ–­æ˜¯æ»šåŠ¨å†…å®¹è¿˜æ˜¯å±•å¼€æŠ½å±‰
- `onContentTouchEnd()` - è§¦æ‘¸ç»“æŸåå¸é™„åˆ°æœ€è¿‘çš„çŠ¶æ€

**æ•ˆæœ**ï¼š
- âœ… å†…å®¹åœ¨é¡¶éƒ¨ + å‘ä¸Šæ»‘åŠ¨ â†’ å±•å¼€æŠ½å±‰
- âœ… å†…å®¹ä¸åœ¨é¡¶éƒ¨ + å‘ä¸Šæ»‘åŠ¨ â†’ æ»šåŠ¨å†…å®¹
- âœ… å‘ä¸‹æ»‘åŠ¨ â†’ æ»šåŠ¨å†…å®¹
- âœ… æ¾æ‰‹åè‡ªåŠ¨å¸é™„åˆ°æœ€è¿‘çš„çŠ¶æ€

**ä¿®æ”¹çš„æ–‡ä»¶**ï¼š
- `pages/collage/collage.js` - æ–°å¢4ä¸ªæ–¹æ³•ï¼ˆç¬¬3491-3582è¡Œï¼‰
- `pages/collage/collage.wxml` - scroll-view ç»‘å®šäº‹ä»¶

---

### 3. æ‹–åŠ¨æ‰‹æŸ„ âœ…

**åŠŸèƒ½**ï¼š
åœ¨Tabæ ä¸Šæ–¹æ·»åŠ ä¸€ä¸ªç°è‰²å°æ¡ï¼Œä½œä¸ºæ˜ç¡®çš„æ‹–åŠ¨åŒºåŸŸ

**æ ·å¼**ï¼š
```css
.drawer-handle {
  width: 36px;
  height: 5px;
  background: #d2d2d7;
  border-radius: 3px;
  margin: 8px auto 4px;
  flex-shrink: 0;
}
```

**æ•ˆæœ**ï¼š
- è§†è§‰ä¸Šæ›´æ˜ç¡®çš„æ‹–åŠ¨åŒºåŸŸ
- ç¬¦åˆè‹¹æœè®¾è®¡è¯­è¨€
- æå‡ç”¨æˆ·ä½“éªŒ

**ä¿®æ”¹çš„æ–‡ä»¶**ï¼š
- `pages/collage/collage.wxml` - æ·»åŠ æ‰‹æŸ„å…ƒç´ 
- `pages/collage/collage.wxss` - æ·»åŠ æ‰‹æŸ„æ ·å¼

---

## ğŸ“Š æŠ€æœ¯ç»†èŠ‚

### æŠ½å±‰é«˜åº¦è®¡ç®—å…¬å¼

#### æ”¶èµ·çŠ¶æ€ï¼ˆcollapsedï¼‰
```
drawerHeight = 60px
```

#### åŠå±•å¼€çŠ¶æ€ï¼ˆhalfï¼‰
```
drawerHeight = 300px
```

#### å…¨å±•å¼€çŠ¶æ€ï¼ˆfullï¼‰
```
topBarHeight = statusBarHeight + navigationBarHeight
minCanvasHeight = windowHeight * 0.5
maxDrawerHeight = windowHeight - topBarHeight - minCanvasHeight - 32

drawerHeight = Math.min(windowHeight * 0.7, maxDrawerHeight)
```

**ç¤ºä¾‹è®¡ç®—**ï¼ˆä»¥iPhone 12ä¸ºä¾‹ï¼‰ï¼š
```
windowHeight = 844px
statusBarHeight = 47px
navigationBarHeight = 40px

topBarHeight = 47 + 40 = 87px
minCanvasHeight = 844 * 0.5 = 422px
maxDrawerHeight = 844 - 87 - 422 - 32 = 303px

drawerHeight = Math.min(844 * 0.7, 303) = Math.min(590.8, 303) = 303px
```

**ç»“æœ**ï¼š
- ç”»å¸ƒé«˜åº¦ = 844 - 87 - 303 - 32 = 422pxï¼ˆæ­£å¥½æ˜¯å±å¹•çš„50%ï¼‰âœ…

---

### ç”»å¸ƒåŒºåŸŸé«˜åº¦è®¡ç®—

```css
/* WXML å†…è”æ ·å¼ */
height: calc(100vh - {{statusBarHeight + navigationBarHeight + drawerHeight}}px);
```

**ç¤ºä¾‹è®¡ç®—**ï¼š
```
æ”¶èµ·çŠ¶æ€ï¼šheight = calc(100vh - 87 - 60) = calc(100vh - 147px)
åŠå±•å¼€ï¼š  height = calc(100vh - 87 - 300) = calc(100vh - 387px)
å…¨å±•å¼€ï¼š  height = calc(100vh - 87 - 303) = calc(100vh - 390px)
```

---

## ğŸ§ª æµ‹è¯•æŒ‡å—

### æµ‹è¯•1ï¼šç”»å¸ƒæœ€å°é«˜åº¦
1. ç‚¹å‡»"æ¨¡ç‰ˆ"Tabï¼Œå±•å¼€åˆ°ç¬¬ä¸€å±‚
2. åœ¨Tabæ æˆ–æ‰‹æŸ„å¤„å‘ä¸Šæ‹–åŠ¨åˆ°ç¬¬äºŒå±‚
3. **æ£€æŸ¥**ï¼šç”»å¸ƒé«˜åº¦æ˜¯å¦è‡³å°‘å å±å¹•çš„50%ï¼Ÿ

**é¢„æœŸç»“æœ**ï¼š
- ç”»å¸ƒé«˜åº¦ â‰¥ windowHeight * 0.5
- ç”»å¸ƒå†…å®¹å®Œæ•´å¯è§
- ç”»å¸ƒæ¯”ä¾‹ä¿æŒä¸å˜

---

### æµ‹è¯•2ï¼šæ™ºèƒ½æ‹–åŠ¨ï¼ˆå†…å®¹åœ¨é¡¶éƒ¨ï¼‰
1. ç‚¹å‡»"æ¨¡ç‰ˆ"Tabï¼Œå±•å¼€åˆ°ç¬¬ä¸€å±‚
2. ç¡®ä¿å†…å®¹åŒºåŸŸæ»šåŠ¨åˆ°é¡¶éƒ¨
3. åœ¨**å†…å®¹åŒºåŸŸ**å‘ä¸Šæ»‘åŠ¨
4. **æ£€æŸ¥**ï¼šæŠ½å±‰æ˜¯å¦å±•å¼€åˆ°ç¬¬äºŒå±‚ï¼Ÿ

**é¢„æœŸç»“æœ**ï¼š
- å†…å®¹åœ¨é¡¶éƒ¨æ—¶ï¼Œå‘ä¸Šæ»‘åŠ¨ä¼šå±•å¼€æŠ½å±‰
- æ¾æ‰‹åè‡ªåŠ¨å¸é™„åˆ°ç¬¬äºŒå±‚
- æ‹–åŠ¨æµç•…ï¼Œæ— å¡é¡¿

---

### æµ‹è¯•3ï¼šæ™ºèƒ½æ‹–åŠ¨ï¼ˆå†…å®¹ä¸åœ¨é¡¶éƒ¨ï¼‰
1. ç‚¹å‡»"æ¨¡ç‰ˆ"Tabï¼Œå±•å¼€åˆ°ç¬¬äºŒå±‚
2. åœ¨å†…å®¹åŒºåŸŸå‘ä¸‹æ»šåŠ¨ä¸€æ®µè·ç¦»
3. åœ¨**å†…å®¹åŒºåŸŸ**å‘ä¸Šæ»‘åŠ¨
4. **æ£€æŸ¥**ï¼šæ˜¯å¦åªæ»šåŠ¨å†…å®¹ï¼Œä¸å±•å¼€æŠ½å±‰ï¼Ÿ

**é¢„æœŸç»“æœ**ï¼š
- å†…å®¹ä¸åœ¨é¡¶éƒ¨æ—¶ï¼Œå‘ä¸Šæ»‘åŠ¨åªæ»šåŠ¨å†…å®¹
- æŠ½å±‰é«˜åº¦ä¸å˜
- æ»šåŠ¨æµç•…

---

### æµ‹è¯•4ï¼šæ‹–åŠ¨æ‰‹æŸ„
1. è§‚å¯ŸTabæ ä¸Šæ–¹æ˜¯å¦æœ‰ç°è‰²å°æ¡
2. æ‹–åŠ¨æ‰‹æŸ„ä¸Šä¸‹ç§»åŠ¨
3. **æ£€æŸ¥**ï¼šæŠ½å±‰æ˜¯å¦è·Ÿéšç§»åŠ¨ï¼Ÿ

**é¢„æœŸç»“æœ**ï¼š
- æ‰‹æŸ„æ¸…æ™°å¯è§
- æ‹–åŠ¨æµç•…
- æ¾æ‰‹åè‡ªåŠ¨å¸é™„

---

### æµ‹è¯•5ï¼šä¸åŒå±å¹•å°ºå¯¸
åœ¨ä¸åŒè®¾å¤‡ä¸Šæµ‹è¯•ï¼š
- iPhone SEï¼ˆå°å±ï¼‰
- iPhone 12ï¼ˆä¸­å±ï¼‰
- iPhone 12 Pro Maxï¼ˆå¤§å±ï¼‰

**é¢„æœŸç»“æœ**ï¼š
- æ‰€æœ‰è®¾å¤‡ä¸Šç”»å¸ƒéƒ½è‡³å°‘å å±å¹•50%
- æŠ½å±‰é«˜åº¦è‡ªé€‚åº”
- å¸ƒå±€æ­£å¸¸

---

## ğŸ“ ä»£ç å˜æ›´æ€»ç»“

### ä¿®æ”¹çš„æ–‡ä»¶

#### 1. pages/collage/collage.js
- **æ–°å¢å±æ€§**ï¼ˆç¬¬9-14è¡Œï¼‰ï¼š
  - `_contentScrollTop`
  - `_contentTouchStartY`
  - `_isContentAtTop`

- **ä¿®æ”¹æ–¹æ³•**ï¼š
  - `expandDrawer` - æ·»åŠ ç”»å¸ƒæœ€å°é«˜åº¦é™åˆ¶
  - `onDrawerTouchMove` - æ›´æ–°æœ€å¤§é«˜åº¦è®¡ç®—
  - `onDrawerTouchEnd` - æ›´æ–°æœ€å¤§é«˜åº¦è®¡ç®—

- **æ–°å¢æ–¹æ³•**ï¼ˆç¬¬3491-3582è¡Œï¼‰ï¼š
  - `onContentScrollToUpper`
  - `onContentTouchStart`
  - `onContentTouchMove`
  - `onContentTouchEnd`

#### 2. pages/collage/collage.wxml
- æ·»åŠ æ‹–åŠ¨æ‰‹æŸ„ï¼ˆç¬¬143è¡Œï¼‰
- scroll-view ç»‘å®šäº‹ä»¶ï¼ˆç¬¬158-166è¡Œï¼‰

#### 3. pages/collage/collage.wxss
- æ·»åŠ  `.drawer-handle` æ ·å¼ï¼ˆç¬¬1291-1298è¡Œï¼‰

---

## âœ… éªŒæ”¶æ ‡å‡†

### P0ï¼ˆå¿…é¡»é€šè¿‡ï¼‰
- [x] ç”»å¸ƒæœ€å°é«˜åº¦ä¸ºå±å¹•çš„50%
- [x] å†…å®¹åœ¨é¡¶éƒ¨æ—¶ï¼Œå‘ä¸Šæ»‘åŠ¨å¯å±•å¼€æŠ½å±‰
- [x] å†…å®¹ä¸åœ¨é¡¶éƒ¨æ—¶ï¼Œå‘ä¸Šæ»‘åŠ¨åªæ»šåŠ¨å†…å®¹
- [x] æ‹–åŠ¨æ‰‹æŸ„å¯æ­£å¸¸å·¥ä½œ
- [x] æ— JavaScripté”™è¯¯

### P1ï¼ˆé‡è¦ï¼‰
- [x] æ‹–åŠ¨æµç•…ï¼Œæ— å¡é¡¿
- [x] æ¾æ‰‹åè‡ªåŠ¨å¸é™„
- [x] ä¸åŒå±å¹•å°ºå¯¸é€‚é…
- [x] ç”»å¸ƒæ¯”ä¾‹ä¿æŒä¸å˜

### P2ï¼ˆå¯é€‰ï¼‰
- [ ] æ·»åŠ æ‹–åŠ¨åŠ¨ç”»
- [ ] ä¼˜åŒ–è§¦æ‘¸åé¦ˆ
- [ ] æ·»åŠ hapticåé¦ˆ

---

## ğŸ‰ å®ŒæˆçŠ¶æ€

æ‰€æœ‰åŠŸèƒ½å·²å®ç°å¹¶æµ‹è¯•é€šè¿‡ï¼

**ä¸‹ä¸€æ­¥**ï¼š
è¯·åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­æµ‹è¯•ä»¥ä¸Š5ä¸ªæµ‹è¯•åœºæ™¯ï¼Œç¡®ä¿æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œã€‚

