# 修复验证清单

## 🚀 快速验证（3分钟）

### 验证1：画布实时压缩 ⏱️ 1分钟

**操作步骤**：
1. 打开微信开发者工具
2. 进入拼图页面（pages/collage/collage）
3. 点击"模版"Tab

**检查点**：
- [ ] 抽屉展开到第一层（300px）
- [ ] 画布立即压缩，高度减小
- [ ] 画布内容完整可见，无遮挡
- [ ] 画布比例保持不变（如1:1、16:9等）

**预期效果**：
```
展开前：画布高度约 600px
展开后：画布高度约 300px（根据屏幕尺寸和抽屉高度计算）
```

---

### 验证2：拖动时画布实时调整 ⏱️ 1分钟

**操作步骤**：
1. 在Tab标签栏区域向上拖动
2. 慢慢拖动，观察画布变化
3. 向下拖动，观察画布变化

**检查点**：
- [ ] 向上拖动时，画布实时压缩
- [ ] 向下拖动时，画布实时放大
- [ ] 拖动流畅，无卡顿
- [ ] 画布比例始终保持不变

**预期效果**：
- 拖动过程中画布高度实时变化
- 每50ms更新一次（节流优化）
- 视觉上流畅自然

---

### 验证3：第二层可展开 ⏱️ 30秒

**操作步骤**：
1. 点击任意Tab，抽屉展开到第一层
2. 继续向上拖动
3. 拖动到接近屏幕顶部
4. 松手

**检查点**：
- [ ] 可以继续向上拖动
- [ ] 抽屉高度继续增加
- [ ] 可以拖动到约70%屏幕高度
- [ ] 松手后自动吸附到第二层

**预期效果**：
```
第一层：300px
第二层：约 screenHeight * 0.7（例如：667 * 0.7 ≈ 467px）
```

---

### 验证4：收起按钮位置 ⏱️ 30秒

**操作步骤**：
1. 点击任意Tab，抽屉展开
2. 观察右上角的收起按钮
3. 拖动抽屉到不同高度
4. 观察按钮位置变化

**检查点**：
- [ ] 收起按钮在抽屉外的右上角
- [ ] 白色背景，带阴影
- [ ] 位置 = 抽屉高度 + 8px
- [ ] 随抽屉高度动态调整
- [ ] 点击有缩放反馈

**预期效果**：
```
收起状态：按钮不显示
第一层：按钮在抽屉上方8px处（bottom: 308px）
第二层：按钮在抽屉上方8px处（bottom: 约475px）
```

---

## 📋 详细验证（10分钟）

### 场景1：不同Tab切换

**操作步骤**：
1. 依次点击：海报、模版、拼接、自由、设置
2. 每次点击后观察画布和抽屉

**检查点**：
- [ ] 每次点击Tab，抽屉都展开到第一层
- [ ] 画布都正确压缩
- [ ] 收起按钮都正确显示
- [ ] Tab内容正确切换

---

### 场景2：不同画布比例

**操作步骤**：
1. 点击"模版"Tab
2. 选择不同的画布比例（1:1、16:9、9:16等）
3. 每次选择后拖动抽屉

**检查点**：
- [ ] 不同比例下画布都正确压缩
- [ ] 画布比例始终保持正确
- [ ] 拖动时画布实时调整
- [ ] 无变形或错位

---

### 场景3：添加图片后

**操作步骤**：
1. 选择一个布局模板
2. 添加几张图片
3. 拖动抽屉到不同高度

**检查点**：
- [ ] 画布随抽屉实时调整
- [ ] 图片内容正确重绘
- [ ] 图片无变形
- [ ] 性能流畅

---

### 场景4：快速操作

**操作步骤**：
1. 快速拖动抽屉上下移动
2. 快速切换Tab
3. 快速点击收起按钮

**检查点**：
- [ ] 无卡顿或闪烁
- [ ] 状态切换正确
- [ ] 无JavaScript错误
- [ ] 画布重绘正常

---

## 🐛 问题排查

### 如果画布未压缩

**检查**：
1. 打开控制台，查看是否有错误
2. 查看日志："更新画布尺寸，当前抽屉高度: xxx"
3. 检查 `updateCanvasSizeForDrawer` 是否被调用

**可能原因**：
- `aspectRatio` 或 `aspectRatios` 未初始化
- Canvas未正确初始化
- 计算逻辑错误

---

### 如果无法拖动到第二层

**检查**：
1. 查看控制台是否有错误
2. 检查 `windowHeight` 的值
3. 检查 `maxHeight` 的计算

**可能原因**：
- `windowHeight` 未正确获取
- 高度限制设置错误
- 触摸事件未正确绑定

---

### 如果收起按钮位置不对

**检查**：
1. 检查元素的 `style` 属性
2. 查看 `bottom` 的值是否正确
3. 检查CSS中的 `z-index`

**可能原因**：
- 内联样式未正确设置
- CSS冲突
- `drawerHeight` 未更新

---

## ✅ 验收标准

### P0（必须通过）

- [ ] 抽屉展开时画布立即压缩
- [ ] 拖动抽屉时画布实时调整
- [ ] 可以流畅拖动到第二层
- [ ] 收起按钮在抽屉外右上角
- [ ] 无JavaScript错误

### P1（重要）

- [ ] 画布比例保持不变
- [ ] 收起按钮位置随抽屉动态调整
- [ ] 性能流畅，无卡顿
- [ ] 不同画布比例下都正常

### P2（可选）

- [ ] 添加图片后重绘正常
- [ ] 不同屏幕尺寸适配
- [ ] 快速操作无问题

---

## 📊 测试报告

### 测试环境
- **测试日期**：2025-11-06
- **测试工具**：微信开发者工具 v_____
- **测试设备**：_____
- **基础库版本**：_____

### 测试结果

| 验证项 | 状态 | 备注 |
|--------|------|------|
| 画布实时压缩 | ✅ / ❌ |  |
| 拖动时实时调整 | ✅ / ❌ |  |
| 第二层可展开 | ✅ / ❌ |  |
| 收起按钮位置 | ✅ / ❌ |  |
| 不同Tab切换 | ✅ / ❌ |  |
| 不同画布比例 | ✅ / ❌ |  |
| 添加图片后 | ✅ / ❌ |  |
| 快速操作 | ✅ / ❌ |  |

### 发现的问题

1. **问题描述**：
   - 严重程度：高 / 中 / 低
   - 复现步骤：
   - 预期结果：
   - 实际结果：

### 测试结论

- [ ] 所有P0测试项通过，可以发布
- [ ] 部分P0测试项未通过，需要修复
- [ ] 发现新问题，需要进一步修复

---

## 🎯 下一步

### 如果测试通过

1. ✅ 标记所有任务为完成
2. ✅ 提交代码
3. ✅ 更新版本号
4. ✅ 发布上线

### 如果测试未通过

1. 📝 记录问题详情
2. 🔍 分析问题原因
3. 🛠️ 修复问题
4. 🧪 重新测试

---

**版本**: v1.1.0  
**创建日期**: 2025-11-06  
**测试负责人**: ___________

