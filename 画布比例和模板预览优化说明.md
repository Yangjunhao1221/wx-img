# ç”»å¸ƒæ¯”ä¾‹å’Œæ¨¡æ¿é¢„è§ˆä¼˜åŒ–è¯´æ˜

## åŠŸèƒ½1: ç”»å¸ƒæ¯”ä¾‹é€‰æ‹© âœ…

### åŠŸèƒ½æè¿°
åœ¨å¸ƒå±€é€‰æ‹©é¡µé¢æ·»åŠ ç”»å¸ƒæ¯”ä¾‹é€‰æ‹©å™¨ï¼Œæ”¯æŒå¤šç§å¸¸ç”¨æ¯”ä¾‹ï¼ŒåŒ…æ‹¬ç¤¾äº¤åª’ä½“ã€æµ·æŠ¥ã€çº¸å¼ ç­‰å¸¸è§å°ºå¯¸ã€‚

### æ”¯æŒçš„æ¯”ä¾‹

| æ¯”ä¾‹ | è¯´æ˜ | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| **1:1 æ­£æ–¹å½¢** | æ­£æ–¹å½¢ç”»å¸ƒ | Instagramå¸–å­ã€å¾®ä¿¡æœ‹å‹åœˆ |
| **3:4 ç«–ç‰ˆ** | ç«–ç‰ˆç…§ç‰‡ | æ‰‹æœºå£çº¸ã€ç«–ç‰ˆæµ·æŠ¥ |
| **4:3 æ¨ªç‰ˆ** | æ¨ªç‰ˆç…§ç‰‡ | ä¼ ç»Ÿç›¸æœºæ¯”ä¾‹ |
| **9:16 æ‰‹æœºç«–å±** | æ‰‹æœºç«–å± | æŠ–éŸ³ã€å¿«æ‰‹ã€Instagram Story |
| **16:9 æ‰‹æœºæ¨ªå±** | æ‰‹æœºæ¨ªå± | YouTubeã€Bç«™è§†é¢‘å°é¢ |
| **10:16 ç«–ç‰ˆæµ·æŠ¥** | ç«–ç‰ˆæµ·æŠ¥ | å®£ä¼ æµ·æŠ¥ã€æ˜“æ‹‰å® |
| **16:10 æ¨ªç‰ˆæµ·æŠ¥** | æ¨ªç‰ˆæµ·æŠ¥ | æ¨ªå¹…ã€å±•æ¿ |
| **A4 çº¸å¼ ** | A4çº¸å¼ ç«–å‘ | æ‰“å°æ–‡æ¡£ã€ä¼ å• |
| **A4 æ¨ªå‘** | A4çº¸å¼ æ¨ªå‘ | æ¨ªå‘æ–‡æ¡£ã€è¯ä¹¦ |

### ç”¨æˆ·ç•Œé¢

**ä½ç½®**: å¸ƒå±€é€‰æ‹©é¡µé¢é¡¶éƒ¨ï¼Œå›¾ç‰‡æ•°é‡åˆ†ç±»æ ‡ç­¾ä¸Šæ–¹

**æ ·å¼**:
- æ¨ªå‘æ»šåŠ¨åˆ—è¡¨
- åœ†è§’èƒ¶å›ŠæŒ‰é’®
- é€‰ä¸­çŠ¶æ€ï¼šç´«è‰²æ¸å˜èƒŒæ™¯ + ç™½è‰²æ–‡å­—
- æœªé€‰ä¸­çŠ¶æ€ï¼šç°è‰²èƒŒæ™¯ + é»‘è‰²æ–‡å­—

**äº¤äº’**:
- ç‚¹å‡»åˆ‡æ¢æ¯”ä¾‹
- æ˜¾ç¤ºToastæç¤º: "å·²åˆ‡æ¢åˆ° XXX"
- å¦‚æœå·²é€‰æ‹©å¸ƒå±€ï¼Œè‡ªåŠ¨é‡æ–°ç»˜åˆ¶Canvas

### ä»£ç å®ç°

#### 1. æ•°æ®å®šä¹‰ (`pages/collage/collage.js` Line 30-46)

```javascript
aspectRatio: '1:1',
aspectRatios: [
  { label: '1:1 æ­£æ–¹å½¢', value: '1:1', width: 1, height: 1 },
  { label: '3:4 ç«–ç‰ˆ', value: '3:4', width: 3, height: 4 },
  { label: '4:3 æ¨ªç‰ˆ', value: '4:3', width: 4, height: 3 },
  { label: '9:16 æ‰‹æœºç«–å±', value: '9:16', width: 9, height: 16 },
  { label: '16:9 æ‰‹æœºæ¨ªå±', value: '16:9', width: 16, height: 9 },
  { label: '10:16 ç«–ç‰ˆæµ·æŠ¥', value: '10:16', width: 10, height: 16 },
  { label: '16:10 æ¨ªç‰ˆæµ·æŠ¥', value: '16:10', width: 16, height: 10 },
  { label: 'A4 çº¸å¼ ', value: 'A4', width: 210, height: 297 },
  { label: 'A4 æ¨ªå‘', value: 'A4-H', width: 297, height: 210 }
]
```

#### 2. äº‹ä»¶å¤„ç† (`pages/collage/collage.js` Line 468-502)

```javascript
onAspectRatioChange (e) {
  const ratioValue = e.currentTarget?.dataset?.ratio || e.detail?.value;
  
  // å¦‚æœæ˜¯ä»datasetè·å–çš„å€¼(ç‚¹å‡»äº‹ä»¶)
  if (typeof ratioValue === 'string') {
    const ratio = this.data.aspectRatios.find(r => r.value === ratioValue);
    if (ratio) {
      this.setData({
        aspectRatio: ratio.value
      });
      this.calculateCanvasSize(ratio.width, ratio.height);
      
      wx.showToast({
        title: `å·²åˆ‡æ¢åˆ° ${ratio.label}`,
        icon: 'success',
        duration: 1500
      });
      
      console.log('åˆ‡æ¢ç”»å¸ƒæ¯”ä¾‹:', ratio.label);
    }
  }
  
  // å¦‚æœå·²ç»é€‰æ‹©äº†å¸ƒå±€,é‡æ–°ç»˜åˆ¶
  if (this.data.currentLayoutTemplate) {
    this.updateCanvas();
  }
}
```

#### 3. UIç•Œé¢ (`pages/collage/collage.wxml` Line 23-38)

```xml
<!-- ç”»å¸ƒæ¯”ä¾‹é€‰æ‹© -->
<view class="aspect-ratio-section">
  <text class="section-label">ç”»å¸ƒæ¯”ä¾‹</text>
  <scroll-view class="aspect-ratio-scroll" scroll-x>
    <view class="aspect-ratio-list">
      <view
        class="aspect-ratio-item {{aspectRatio === item.value ? 'active' : ''}}"
        wx:for="{{aspectRatios}}"
        wx:key="value"
        data-ratio="{{item.value}}"
        bindtap="onAspectRatioChange"
      >
        <text class="ratio-label">{{item.label}}</text>
      </view>
    </view>
  </scroll-view>
</view>
```

#### 4. æ ·å¼ (`pages/collage/collage.wxss` Line 50-104)

```css
.aspect-ratio-section {
  padding: 16px 20px;
  background: #fff;
  border-bottom: 1px solid #f0f0f0;
}

.aspect-ratio-item {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 8px 16px;
  background: #f5f5f5;
  border: 2px solid transparent;
  border-radius: 20px;
  transition: all 0.3s;
  flex-shrink: 0;
}

.aspect-ratio-item.active {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-color: #667eea;
  box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
}

.aspect-ratio-item.active .ratio-label {
  color: white;
}
```

---

## åŠŸèƒ½2: æ¨¡æ¿é¢„è§ˆå¯è§†åŒ– âœ…

### åŠŸèƒ½æè¿°
å°†åŸæ¥çš„æ–‡å­—å›¾æ ‡é¢„è§ˆæ”¹ä¸ºå¯è§†åŒ–çš„å¸ƒå±€ç»“æ„é¢„è§ˆï¼Œç”¨æˆ·å¯ä»¥ç›´è§‚åœ°çœ‹åˆ°æ¯ä¸ªæ¨¡æ¿çš„å›¾ç‰‡æ’åˆ—æ–¹å¼ã€‚

### é¢„è§ˆæ•ˆæœ

**ç½‘æ ¼å¸ƒå±€**:
- ä½¿ç”¨ CSS Grid æ˜¾ç¤ºç½‘æ ¼ç»“æ„
- æ¯ä¸ªæ ¼å­ç”¨æµ…ç´«è‰²å¡«å……
- æ ¼å­ä¹‹é—´æœ‰é—´éš™
- é€‰ä¸­çŠ¶æ€ï¼šæ·±ç´«è‰²æ¸å˜

**è‡ªå®šä¹‰å¸ƒå±€**:
- ä½¿ç”¨ç»å¯¹å®šä½æ˜¾ç¤ºæ¯ä¸ªå›¾ç‰‡ä½ç½®
- æ ¹æ® positions æ•°ç»„è®¡ç®—ä½ç½®å’Œå°ºå¯¸
- æ¯ä¸ªä½ç½®ç”¨æµ…ç´«è‰²çŸ©å½¢è¡¨ç¤º
- é€‰ä¸­çŠ¶æ€ï¼šæ·±ç´«è‰²æ¸å˜

### è§†è§‰å¯¹æ¯”

**ä¹‹å‰**: 
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    â–¦    â”‚  â† åªæœ‰ä¸€ä¸ªæ–‡å­—å›¾æ ‡
â”‚  2Ã—2ç½‘æ ¼ â”‚
â”‚   4å¼    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç°åœ¨**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”Œâ”€â”¬â”€â”  â”‚  â† å¯è§†åŒ–æ˜¾ç¤º2Ã—2ç½‘æ ¼
â”‚ â”œâ”€â”¼â”€â”¤  â”‚
â”‚ â””â”€â”´â”€â”˜  â”‚
â”‚  2Ã—2ç½‘æ ¼ â”‚
â”‚   4å¼    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä»£ç å®ç°

#### 1. WXMLæ¨¡æ¿ (`pages/collage/collage.wxml` Line 67-102)

```xml
<view class="template-preview-visual">
  <!-- ç½‘æ ¼å¸ƒå±€é¢„è§ˆ -->
  <view 
    wx:if="{{item.type === 'grid'}}" 
    class="grid-preview" 
    style="grid-template-rows: repeat({{item.rows}}, 1fr); 
           grid-template-columns: repeat({{item.cols}}, 1fr);"
  >
    <view 
      class="grid-cell" 
      wx:for="{{item.imageCount}}" 
      wx:for-item="cellIndex" 
      wx:key="cellIndex"
    ></view>
  </view>
  
  <!-- è‡ªå®šä¹‰å¸ƒå±€é¢„è§ˆ -->
  <view wx:else class="custom-preview">
    <view 
      class="custom-cell" 
      wx:for="{{item.positions}}" 
      wx:for-item="pos" 
      wx:key="index"
      style="left: {{pos.x * 100}}%; 
             top: {{pos.y * 100}}%; 
             width: {{pos.width * 100}}%; 
             height: {{pos.height * 100}}%;"
    ></view>
  </view>
</view>
```

#### 2. æ ·å¼ (`pages/collage/collage.wxss` Line 214-268)

```css
/* å¯è§†åŒ–é¢„è§ˆå®¹å™¨ */
.template-preview-visual {
  width: 80px;
  height: 80px;
  background: #f8f8f8;
  border-radius: 8px;
  padding: 6px;
  position: relative;
  overflow: hidden;
}

.layout-template-card.selected .template-preview-visual {
  background: white;
  box-shadow: 0 0 0 2px #667eea inset;
}

/* ç½‘æ ¼å¸ƒå±€é¢„è§ˆ */
.grid-preview {
  width: 100%;
  height: 100%;
  display: grid;
  gap: 3px;
}

.grid-cell {
  background: linear-gradient(135deg, #a8b5ff 0%, #c5d0ff 100%);
  border-radius: 3px;
  border: 1px solid #8899ff;
}

.layout-template-card.selected .grid-cell {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-color: #5566dd;
}

/* è‡ªå®šä¹‰å¸ƒå±€é¢„è§ˆ */
.custom-preview {
  width: 100%;
  height: 100%;
  position: relative;
}

.custom-cell {
  position: absolute;
  background: linear-gradient(135deg, #a8b5ff 0%, #c5d0ff 100%);
  border-radius: 3px;
  border: 1px solid #8899ff;
  box-sizing: border-box;
}

.layout-template-card.selected .custom-cell {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-color: #5566dd;
}
```

---

## æµ‹è¯•æ­¥éª¤

### æµ‹è¯•åŠŸèƒ½1: ç”»å¸ƒæ¯”ä¾‹é€‰æ‹©

1. **è¿›å…¥å¸ƒå±€é€‰æ‹©é¡µé¢**
2. **æŸ¥çœ‹ç”»å¸ƒæ¯”ä¾‹é€‰æ‹©å™¨**
   - åº”è¯¥åœ¨é¡µé¢é¡¶éƒ¨ï¼Œ"é€‰æ‹©å¸ƒå±€æ¨¡æ¿"æ ‡é¢˜ä¸‹æ–¹
   - æ˜¾ç¤º9ä¸ªæ¯”ä¾‹é€‰é¡¹
   - é»˜è®¤é€‰ä¸­"1:1 æ­£æ–¹å½¢"ï¼ˆç´«è‰²èƒŒæ™¯ï¼‰
3. **ç‚¹å‡»ä¸åŒæ¯”ä¾‹**
   - ç‚¹å‡»"3:4 ç«–ç‰ˆ"
   - åº”è¯¥æ˜¾ç¤ºToast: "å·²åˆ‡æ¢åˆ° 3:4 ç«–ç‰ˆ"
   - è¯¥é€‰é¡¹å˜ä¸ºç´«è‰²èƒŒæ™¯
4. **é€‰æ‹©å¸ƒå±€ååˆ‡æ¢æ¯”ä¾‹**
   - é€‰æ‹©ä¸€ä¸ªå¸ƒå±€æ¨¡æ¿
   - ä¸Šä¼ å›¾ç‰‡
   - è¿”å›å¸ƒå±€é€‰æ‹©é¡µé¢
   - åˆ‡æ¢æ¯”ä¾‹
   - éªŒè¯Canvasæ˜¯å¦æŒ‰æ–°æ¯”ä¾‹é‡æ–°ç»˜åˆ¶

### æµ‹è¯•åŠŸèƒ½2: æ¨¡æ¿é¢„è§ˆå¯è§†åŒ–

1. **è¿›å…¥å¸ƒå±€é€‰æ‹©é¡µé¢**
2. **æŸ¥çœ‹æ¨¡æ¿å¡ç‰‡**
   - æ¯ä¸ªæ¨¡æ¿åº”è¯¥æ˜¾ç¤ºå¯è§†åŒ–çš„å¸ƒå±€ç»“æ„
   - ç½‘æ ¼å¸ƒå±€ï¼šæ˜¾ç¤ºç½‘æ ¼æ ¼å­
   - è‡ªå®šä¹‰å¸ƒå±€ï¼šæ˜¾ç¤ºä¸è§„åˆ™çš„çŸ©å½¢æ’åˆ—
3. **ç‚¹å‡»ä¸åŒåˆ†ç±»**
   - ç‚¹å‡»"2å¼ "åˆ†ç±»
   - åº”è¯¥çœ‹åˆ°æ¨ªå‘æ’åˆ—ã€ç«–å‘æ’åˆ—ç­‰ä¸åŒçš„å¯è§†åŒ–é¢„è§ˆ
4. **é€‰ä¸­æ¨¡æ¿**
   - ç‚¹å‡»ä¸€ä¸ªæ¨¡æ¿
   - é¢„è§ˆå›¾åº”è¯¥å˜ä¸ºæ·±ç´«è‰²
   - è¾¹æ¡†å˜ä¸ºç´«è‰²

---

## ç”¨æˆ·ä½“éªŒæå‡

### åŠŸèƒ½1: ç”»å¸ƒæ¯”ä¾‹
- âœ… **æ›´å¤šé€‰æ‹©**: ä»6ç§æ¯”ä¾‹å¢åŠ åˆ°9ç§
- âœ… **æ¸…æ™°æ ‡æ³¨**: æ¯ä¸ªæ¯”ä¾‹éƒ½æœ‰è¯´æ˜ï¼ˆå¦‚"æ‰‹æœºç«–å±"ã€"A4çº¸å¼ "ï¼‰
- âœ… **å³æ—¶åé¦ˆ**: åˆ‡æ¢æ—¶æ˜¾ç¤ºToastæç¤º
- âœ… **æ™ºèƒ½é‡ç»˜**: å·²é€‰æ‹©å¸ƒå±€æ—¶è‡ªåŠ¨é‡æ–°ç»˜åˆ¶

### åŠŸèƒ½2: æ¨¡æ¿é¢„è§ˆ
- âœ… **ç›´è§‚å¯è§†**: ä¸€çœ¼å°±èƒ½çœ‹å‡ºå¸ƒå±€ç»“æ„
- âœ… **ç¾è§‚è®¾è®¡**: æ¸å˜è‰²å½©ï¼Œåœ†è§’è®¾è®¡
- âœ… **é€‰ä¸­é«˜äº®**: é€‰ä¸­çŠ¶æ€æ›´æ˜æ˜¾
- âœ… **æ”¯æŒæ‰€æœ‰å¸ƒå±€**: ç½‘æ ¼å’Œè‡ªå®šä¹‰å¸ƒå±€éƒ½èƒ½æ­£ç¡®æ˜¾ç¤º

---

## æŠ€æœ¯äº®ç‚¹

### 1. åŠ¨æ€Gridå¸ƒå±€
ä½¿ç”¨ `grid-template-rows` å’Œ `grid-template-columns` åŠ¨æ€ç”Ÿæˆç½‘æ ¼ï¼š
```css
grid-template-rows: repeat({{item.rows}}, 1fr);
grid-template-columns: repeat({{item.cols}}, 1fr);
```

### 2. ç™¾åˆ†æ¯”å®šä½
è‡ªå®šä¹‰å¸ƒå±€ä½¿ç”¨ç™¾åˆ†æ¯”è®¡ç®—ä½ç½®ï¼š
```css
left: {{pos.x * 100}}%;
top: {{pos.y * 100}}%;
width: {{pos.width * 100}}%;
height: {{pos.height * 100}}%;
```

### 3. æ¸å˜è‰²å½©
ä½¿ç”¨çº¿æ€§æ¸å˜å¢å¼ºè§†è§‰æ•ˆæœï¼š
```css
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
```

---

## æ³¨æ„äº‹é¡¹

1. âš ï¸ **æ¯”ä¾‹åˆ‡æ¢**: åˆ‡æ¢æ¯”ä¾‹ä¼šæ”¹å˜Canvaså°ºå¯¸ï¼Œå¯èƒ½å½±å“å·²æœ‰å›¾ç‰‡çš„æ˜¾ç¤º
2. âš ï¸ **è‡ªå®šä¹‰å¸ƒå±€**: positionsæ•°ç»„å¿…é¡»æ­£ç¡®å®šä¹‰ï¼Œå¦åˆ™é¢„è§ˆå¯èƒ½ä¸å‡†ç¡®
3. âœ… **æ€§èƒ½ä¼˜åŒ–**: ä½¿ç”¨CSSè€ŒéCanvasç»˜åˆ¶é¢„è§ˆï¼Œæ€§èƒ½æ›´å¥½
4. âœ… **å“åº”å¼**: é¢„è§ˆå›¾å¤§å°å›ºå®šä¸º80Ã—80pxï¼Œé€‚é…å„ç§å±å¹•

---

## æ€»ç»“

è¿™ä¸¤ä¸ªåŠŸèƒ½æå¤§åœ°æå‡äº†ç”¨æˆ·ä½“éªŒï¼š

1. **ç”»å¸ƒæ¯”ä¾‹é€‰æ‹©**: è®©ç”¨æˆ·å¯ä»¥æ ¹æ®ä¸åŒåœºæ™¯é€‰æ‹©åˆé€‚çš„ç”»å¸ƒå°ºå¯¸
2. **æ¨¡æ¿é¢„è§ˆå¯è§†åŒ–**: è®©ç”¨æˆ·ä¸€çœ¼å°±èƒ½çœ‹å‡ºæ¯ä¸ªæ¨¡æ¿çš„å¸ƒå±€ç»“æ„

ä¸¤ä¸ªåŠŸèƒ½éƒ½é‡‡ç”¨äº†ç°ä»£åŒ–çš„UIè®¾è®¡ï¼Œä¸æ•´ä½“é£æ ¼ä¿æŒä¸€è‡´ï¼ ğŸ‰

